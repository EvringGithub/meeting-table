wf.define("meetingTime",[],function(){return function(){var r=8,t=17,n=10,i='<li data-value="{0}" class="wf-select-option {2}">{1}<\/li>',u=function(){var n=":";return{toTime:t=>{var i=t%60;return Math.floor(t/60)+n+(i<10?"0"+i:i)},toMinutes:t=>{var i=t.split(n);return parseInt(i[0])*60+parseInt(i[1])}}}();return{render:function(f,e){var c=[],h=new Date,l=h.getHours(),a=h.getMinutes(),o,s;if(l>=t)return i.format("","下班");for(o=h.format("yyyy-MM-dd")==f?l*60+Math.ceil(a/n)*n:r*60;o<=t*60;o=o+n)s=u.toTime(o),c.push(i.format(s,s,s==e?"wf-select-option-selected":""));return c.join("")}}}()});wf.define("meeting",[],function(){return(()=>{var n=(n,t,i)=>{$.post(n,t,n=>{$.isFunction(i)&&i(n)})};return{save:(t,i)=>{n("meeting/save",t,i)},remove:(t,i)=>{n("meeting/delete",{id:t},i)}}})()});wf.define("meetingCheck",[],function(){return function(){var n=function(n){return n.substring(0,1)>1&&(n="0"+n),n};return{check:function(t,i){return(t.startTime=n(t.startTime),t.endTime=n(t.endTime),i.startTime=n(i.startTime),i.endTime=n(i.endTime),t.endTime<=t.startTime)?!1:t.date==i.date&&t.tableRoom==i.tableRoom&&(t.startTime>=i.endTime||t.endTime<=i.startTime)?!1:!0}}}});wf.define("meetingCard",[],function(){var n=wf.require("meeting"),t=wf.require("meetingTime"),i=wf.require("meetingCheck");return function(r,u,f){var e=u.find(".meeting-save"),v=u.find(".meeting-delete"),y=u.find(".meeting-startTime"),p=u.find(".meeting-endTime"),c="meeting-saved",l="meeting-edit",s="meeting-editing",h=".meeting-list-wrapper",a="meeting-error",o=n=>u.find('[name="{0}"]'.format(n)),w=function(){var i=["tableRoom","startTime","endTime"],n={date:f},t=[];return e.parents(".meeting-card").each(function(){var u=[],r;for($(this).find(".wf-select-input").each(function(){var n=$(this);u.push(n.val())}),r=0;r<u.length;r++)n[i[r]]=u[r];t.push(n)}),t},b=function(){var n={},r={date:f},u,h,s,t;if(["id","title","userName","tableRoom","startTime","endTime"].forEach(t=>{n[t]=o(t)}),!n.title.val())return n.title.focus(),null;if(!n.userName.val())return n.userName.focus(),null;for(u in n)r[u]=n[u].val();for(h=i(),s=w(),t=0;t<s.length;t++){if(h.check(r,s[t]))return r;e.parent().parent().addClass(a);setTimeout(function(){e.parent().parent().removeClass(a)},2e3)}};return y.find(".time-option").html(t.render(f,o("startTime").val())),p.find(".time-option").html(t.render(f,o("endTime").val())),e.click(function(){var t=b();t&&n.save(t,n=>{n.success&&(t.id||o("id").val(n.id),e.parent().parent().addClass(c),u.closest(h).removeClass(s))})}),v.click(function(){var t=o("id").val(),i=function(){u.closest(h).removeClass(s);u.remove()};t?n.remove(t,n=>{n.success&&i()}):i()}),u.hover(function(){$(this).hasClass(c)&&$(this).find("."+l).show()},function(){$(this).find("."+l).hide()}),u.find("."+l+" .wf-btn").click(function(){u.removeClass(c).closest(h).addClass(s);$(this).parent().hide()}),{addTo:function(n){n.append(u);u.closest(h).addClass(s)}}}});wf.require("page").render("meetingBorad",["UI.Select"],function(){var n=this,t="meeting-temp",i=wf.require("meetingCard"),r=$("."+t).remove().removeClass(t),u;r.find("[data-rendered]").removeAttr("data-rendered");$(".meeting-add").click(function(){var t=$(this),u=r.clone(),f=t.prev().find(".meeting-date").html(),e=i(t,u,f);e.addTo(t.prev());n.refresh()});u=$(".meeting-board-wrapper").find(".meeting-card");$.each(u,function(){i("",$(this),$(this).parent().find(".meeting-date").html())});n.refresh()});