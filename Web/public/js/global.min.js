wf.define("meetingTime",[],function(){return function(){var r=8,t=17,n=10,i='<li data-value="{0}" class="wf-select-option {2}">{1}<\/li>',u=function(){var n=":";return{toTime:t=>{var i=t%60;return Math.floor(t/60)+n+(i<10?"0"+i:i)},toMinutes:t=>{var i=t.split(n);return parseInt(i[0])*60+parseInt(i[1])}}}();return{render:function(f,e){var c=[],h=new Date,l=h.getHours(),a=h.getMinutes(),o,s;if(l>=t)return i.format("","下班");for(o=h.format("yyyy-MM-dd")==f?l*60+Math.ceil(a/n)*n:r*60;o<=t*60;o=o+n)s=u.toTime(o),c.push(i.format(s,s,s==e?"wf-select-option-selected":""));return c.join("")}}}()});wf.define("meeting",[],function(){return(()=>{var n=(n,t,i)=>{$.post(n,t,n=>{$.isFunction(i)&&i(n)})};return{save:(t,i)=>{n("meeting/save",t,i)},remove:(t,i)=>{n("meeting/delete",{id:t},i)}}})()});wf.define("meetingCheck",[],function(){return function(){var n=function(n){return n.substring(0,1)>1&&(n="0"+n),n};return{check:function(t,i){return(t.startTime=n(t.startTime),t.endTime=n(t.endTime),i.startTime=n(i.startTime),i.endTime=n(i.endTime),t.endTime<=t.startTime)?!1:t.date==i.date&&t.tableRoom==i.tableRoom?t.startTime>=i.endTime||t.endTime<=i.startTime?!0:!1:!0}}}});wf.define("meetingCard",[],function(){var n=wf.require("meeting"),t=wf.require("meetingTime"),i=wf.require("meetingCheck");return function(r,u,f){var e=u.find(".meeting-save"),y=u.find(".meeting-delete"),p=u.find(".meeting-startTime"),w=u.find(".meeting-endTime"),l="meeting-saved",a="meeting-edit",s="meeting-editing",h=".meeting-list-wrapper",c="meeting-error",o=n=>u.find('[name="{0}"]'.format(n)),v=function(n){return n.substring(0,1)>1&&(n="0"+n),n},b=function(){var i=["tableRoom","startTime","endTime"],n={date:f},t=[];return e.parents(".meeting-card").siblings(".meeting-saved").each(function(){var u=[],r;for($(this).find(".wf-select-input").each(function(){var n=$(this);u.push(n.val())}),r=0;r<u.length;r++)n[i[r]]=u[r];t.push(n)}),t},k=function(){var t={},n={date:f},s,l,r,h,u;if(["id","title","userName","tableRoom","startTime","endTime"].forEach(n=>{t[n]=o(n)}),!t.title.val())return t.title.focus(),null;if(!t.userName.val())return t.userName.focus(),null;for(s in t)n[s]=t[s].val();if(l=i(),r=b(),r.length==0)if(n.startTime=v(n.startTime),n.endTime=v(n.endTime),n.endTime<=n.startTime)e.parent().parent().addClass(c),setTimeout(function(){e.parent().parent().removeClass(c)},2e3);else return n;for(h=!0,u=0;u<r.length;u++)l.check(n,r[u])||(h=!1,e.parent().parent().addClass(c),setTimeout(function(){e.parent().parent().removeClass(c)},2e3));if(h)return n};return p.find(".time-option").html(t.render(f,o("startTime").val())),w.find(".time-option").html(t.render(f,o("endTime").val())),e.click(function(){var t=k();t&&n.save(t,n=>{n.success&&(t.id||o("id").val(n.id),e.parent().parent().addClass(l),u.closest(h).removeClass(s))})}),y.click(function(){var t=o("id").val(),i=function(){u.closest(h).removeClass(s);u.remove()};t?n.remove(t,n=>{n.success&&i()}):i()}),u.hover(function(){$(this).hasClass(l)&&$(this).find("."+a).show()},function(){$(this).find("."+a).hide()}),u.find("."+a+" .wf-btn").click(function(){u.removeClass(l).closest(h).addClass(s);$(this).parent().hide()}),{addTo:function(n){n.append(u);u.closest(h).addClass(s)}}}});wf.require("page").render("meetingBorad",["UI.Select"],function(){var n=this,t="meeting-temp",i=wf.require("meetingCard"),r=$("."+t).remove().removeClass(t),u;r.find("[data-rendered]").removeAttr("data-rendered");$(".meeting-add").click(function(){var t=$(this),u=r.clone(),f=t.prev().find(".meeting-date").html(),e=i(t,u,f);e.addTo(t.prev());n.refresh()});u=$(".meeting-board-wrapper").find(".meeting-card");$.each(u,function(){i("",$(this),$(this).parent().find(".meeting-date").html())});n.refresh()});